# Google Apps Script トリガー設定の修正方法

## ⚠️ 問題

「イベントのソース」に「スプレッドシートから」しか表示されない場合があります。これは、スクリプトがスプレッドシートに紐づいているためです。

## ✅ 解決方法

スプレッドシートに紐づいたスクリプトでも、フォーム送信時に即座に実行できます。以下の設定を行ってください。

### 方法 1: スプレッドシートのトリガーで設定（推奨）

1. **トリガーを追加**

   - Apps Script エディタで「トリガー」タブを開く
   - 「トリガーを追加」をクリック

2. **以下の設定を行う**

| 項目                 | 設定値                                  |
| -------------------- | --------------------------------------- |
| **実行する関数**     | `onFormSubmit`                          |
| **イベントのソース** | `スプレッドシートから` ← これで OK      |
| **イベントの種類**   | `フォーム送信時` ← **重要**: これを選択 |

⚠️ **重要**:

- 「イベントの種類」で「フォーム送信時」を選択すれば、フォーム送信の瞬間に実行されます
- 「スプレッドシートから」でも、「フォーム送信時」を選択すれば即座に実行されます

3. **保存**
   - 「保存」をクリック
   - 権限の承認が必要な場合は承認

### 方法 2: Google フォームに直接スクリプトを追加（代替案）

もし「フォーム送信時」が表示されない場合は、Google フォーム自体にスクリプトを追加することもできます。

1. Google フォームを開く
2. 「⋮」（三点メニュー）→「スクリプトエディタ」を選択
3. 同じコードを追加
4. トリガーを設定（この場合は「フォームから」が表示されます）

---

## 🔍 確認方法

### 正しく設定されている場合の表示

```
実行する関数: onFormSubmit
イベントのソース: スプレッドシートから
イベントの種類: フォーム送信時  ← これが重要！
```

### テスト方法

1. フォームを送信
2. Apps Script エディタに戻る
3. 「実行数」タブで最新の実行を確認
4. ログに以下が表示されれば OK：
   ```
   === onFormSubmit START ===
   Form submission received
   ...
   ```

---

## ⚡ パフォーマンス

「イベントの種類」が「フォーム送信時」であれば、以下のどちらでも即座に実行されます：

- ✅ 「スプレッドシートから」+ 「フォーム送信時」→ 即座に実行
- ✅ 「フォームから」+ 「フォーム送信時」→ 即座に実行

**重要なのは「イベントの種類」が「フォーム送信時」であることです。**

---

## 📝 チェックリスト

- [ ] トリガーを追加
- [ ] 実行する関数: `onFormSubmit`
- [ ] イベントのソース: `スプレッドシートから`（表示される選択肢で OK）
- [ ] **イベントの種類: `フォーム送信時`** ← これが最重要！
- [ ] 保存して権限を承認
- [ ] テスト送信で動作確認
